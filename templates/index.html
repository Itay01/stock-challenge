{% include "header.html" %}
{% import "bootstrap/wtf.html" as wtf %}

  <!-- Page Header -->
  <header class="masthead" style="background-image: url('https://caltech-prod.s3.amazonaws.com/main/images/CollinCamerer-ShortSelling-0.2e16d0ba.fill-1600x810-c100.jpg')">
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="site-heading">
            <h1>Stock Challenge</h1>
            <span class="subheading">By Itay Marom</span>
            <span class="subheading">Version 2.0</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <head>
    <style>
      table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 100%;
      }

      td, th {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
      }

      tr:nth-child(even) {
        background-color: #dddddd;
      }
    </style>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </head>

 <!-- Main Content -->
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <div class="post-preview">
            {% if current_user.is_authenticated %}
              <h4>Cash Balance: <script>document.write(Math.round(({{ current_user.stock_points }} + Number.EPSILON) * 100) / 100);</script> ₪</h4>
              <hr>
            {% endif %}

            {% if all_stocks %}
            <table>
              <tr>
                <th>Stock Symbol</th>
                <th>Company Name</th>
                <th>Current Value</th>
                <th>Change</th>
              </tr>
              {% for stock in all_stocks %}
                <tr>
                  <td><a style="color: #3366CC" href="{{ url_for('show_stock', stock_id=stock.id) }}">{{ stock.stock_name }}</a></td>
                  <td>{{ stock.company_name }}</td>
                  <td>
                    <script>document.write(Math.round(({{ stock.stock_units_value }} + Number.EPSILON) * 100) / 100);</script>
                     ₪</td>
                  <td>{{ stock.stock_diff }} %</td>
                </tr>
              {% endfor %}
            </table>
        </div>
        <hr>
        {% endif %}

        {% if current_user.is_authenticated %}
          <h4>Total Invested: <script>document.write(Math.round(({{ current_user.stocks_value }} + Number.EPSILON) * 100) / 100);</script> ₪</h4>
          <br>
          <h4>Total Money: <script>document.write(Math.round(({{ current_user.stock_points + current_user.stocks_value }} + Number.EPSILON) * 100) / 100);</script> ₪</h4>
        {% endif %}

        <!-- New Stock -->
        {% if current_user.is_authenticated %}
          <hr>
          <div class="clearfix">
            <a id="buy-button" class="btn btn-primary float-right" href="{{ url_for('buy_new_stock') }}">Buy New Stock</a>
            <a id="sell-button" class="btn btn-danger float-left" href="{{ url_for('sell_stock') }}">Sell My Stock</a>
            <script>
            let isMobile = window.navigator.userAgentData.mobile;
              if (isMobile) {
                var buy_btn = document.getElementById("buy-button");
                buy_btn.classList.add("text-center");
                buy_btn.classList.remove("float-right");

                var sell_btn = document.getElementById(sell-button");
                sell_btn.classList.add("text-center");
                sell_btn.classList.remove("float-left");
              }
            </script>
          </div>
        {% endif %}

        {% block modal %}{% endblock %}
        {% block script %}{% endblock %}
      </div>
    </div>
  </div>
  <hr>

{% include "footer.html" %}
